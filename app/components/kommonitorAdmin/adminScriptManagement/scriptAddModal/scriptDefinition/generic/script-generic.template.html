<h4>Generische manuelle Definition aller Skript-Daten</h4>

<p>Mindestens ein (Basis-)Indikator oder eine Georessource muss angegeben werden, aus dem sich der Ziel-Indikator
	ableitet. Beliebig viele sind m&ouml;glich.</p>

<div class="row vertical-align">
	<div class="col-md-10 col-sm-12 col-xs-12">
		<!-- <div style="text-align: left;"> -->
		<div class="box box-danger collapsed-box" style="background: #ebf0fd;">
			<div class="box-header">
				<h3 class="box-title">Notwendige (Basis-)Indikatoren</h3>

				<div class="box-tools pull-right">
					<button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-plus"></i>
					</button>
				</div>
			</div>
			<!-- /.box-header -->
			<div class="box-body">

				<!-- Inputs for new reference -->

				<div class="row vertical-align">
					<div class="col-md-12 col-sm-12 col-xs-12">
						<div class="form-group">
							<label>Auswahl der f&uuml;r die Berechnung erforderlichen (Basis-)Indikatoren</label>
							<div class="input-group">
								<span class="input-group-addon"><i class="fas fa-filter"></i></span>
								<input type="text" class="form-control input-sm" placeholder="Stichwortfilter" ng-model-options="{debounce: 500, blur: 0}"
									ng-model="indicatorNameFilter">
							</div>
							<br />
							<select ng-model="tmpIndicatorSelection" size="5"
								ng-options="indicatorMetadata as indicatorMetadata.indicatorName for indicatorMetadata in $ctrl.kommonitorDataExchangeServiceInstance.availableIndicators | filter:indicatorNameFilter"
								class="form-control">
								<option disabled selected value> -- Indikator als Berechnungsgrundlage w&auml;hlen --
								</option>
							</select>
							<div class="help-block with-errors"></div>
						</div>
					</div>
				</div>

				<div class="row vertical-align">
					<div class="col-md-6 col-sm-6 col-xs-12">
						<div class="form-group">
							<label>ID des selektierten Indikators</label>
							<input type="text" class="form-control input-sm" disabled placeholder="IndikatorenId"
								ng-model="tmpIndicatorSelection.indicatorId">
							<div class="help-block with-errors"></div>
						</div>
					</div>
					<div class="col-md-6 col-sm-6 col-xs-12">
						<div class="form-group">
							<label>Name des selektierten Indikators</label>
							<input type="text" class="form-control input-sm" disabled placeholder="IndikatorenName"
								ng-model="tmpIndicatorSelection.indicatorName">
							<div class="help-block with-errors"></div>
						</div>
					</div>
				</div>

				<div class="row vertical-align">
					<div class="col-md-3 col-sm-6 col-xs-12">
						<div class="form-group">
							<button class="btn btn-success btn-sm" ng-disabled="!tmpIndicatorSelection"
								ng-click="$ctrl.kommonitorScriptHelperServiceInstance.addBaseIndicator(tmpIndicatorSelection)">Hinzuf&uuml;gen</button>
							<div class="help-block with-errors"></div>
						</div>
					</div>
				</div>

				<br />
				<br />

				<!-- Table to display currently specified base indicators -->
				<div class="row vertical-align">
					<div class="col-md-12 col-sm-12 col-xs-12">
						<label>&Uuml;bersicht der definierten (Basis-)Indikatoren</label>
						<table class="table table-condensed">
							<thead>
								<tr>
									<th>Editierfunktionen</th>
									<th>ID des Indikators</th>
									<th>Name des Indikators</th>
									<th>Beschreibung</th>
									<th>Einheit</th>
								</tr>
							</thead>
							<tbody>
								<tr
									ng-repeat="baseIndicator in $ctrl.kommonitorScriptHelperServiceInstance.requiredIndicators_tmp">
									<td>
										<div class="btn-group btn-group-sm">
											<button class="btn btn-danger btn-sm" type="button"
												ng-click="$ctrl.kommonitorScriptHelperServiceInstance.removeBaseIndicator(baseIndicator)"
												title="Eintrag l&ouml;schen"><i class="fas fa-trash"></i></button>
										</div>
									</td>
									<td>{{baseIndicator.indicatorId}}</td>
									<td>{{baseIndicator.indicatorName}}</td>
									<td>{{baseIndicator.metadata.description}}</td>
									<td>{{baseIndicator.unit}}</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>


			</div>
			<!-- Box Body -->
		</div>
		<!-- Box -->

		<!-- </div>	 -->

	</div>

</div>

<div class="row vertical-align">
	<div class="col-md-10 col-sm-12 col-xs-12">
		<!-- <div style="text-align: left;"> -->
		<div class="box box-danger collapsed-box" style="background: #ebf0fd;">
			<div class="box-header">
				<h3 class="box-title">Notwendige Georessourcen</h3>

				<div class="box-tools pull-right">
					<button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-plus"></i>
					</button>
				</div>
			</div>
			<!-- /.box-header -->
			<div class="box-body">

				<!-- Inputs for new reference -->

				<div class="row vertical-align">
					<div class="col-md-12 col-sm-12 col-xs-12">
						<div class="form-group">
							<label>Auswahl der f&uuml;r die Berechnung erforderlichen Georessourcen</label>
							<div class="input-group">
								<span class="input-group-addon"><i class="fas fa-filter"></i></span>
								<input type="text" class="form-control input-sm" placeholder="Stichwortfilter" ng-model-options="{debounce: 500, blur: 0}"
									ng-model="georesourceNameFilter">
							</div>
							<br />
							<select ng-model="tmpGeoresourceSelection" size="5"
								ng-options="georesourceMetadata as georesourceMetadata.datasetName for georesourceMetadata in $ctrl.kommonitorDataExchangeServiceInstance.availableGeoresources | filter:georesourceNameFilter"
								class="form-control">
								<option disabled selected value> -- Georessource als Berechnungsgrundlage w&auml;hlen --
								</option>
							</select>
							<div class="help-block with-errors"></div>
						</div>
					</div>
				</div>

				<div class="row vertical-align">
					<div class="col-md-6 col-sm-6 col-xs-12">
						<div class="form-group">
							<label>ID der selektierten Georessource</label>
							<input type="text" class="form-control input-sm" disabled placeholder="GeoressourcenId"
								ng-model="tmpGeoresourceSelection.georesourceId">
							<div class="help-block with-errors"></div>
						</div>
					</div>
					<div class="col-md-6 col-sm-6 col-xs-12">
						<div class="form-group">
							<label>Name der selektierten Georessource</label>
							<input type="text" class="form-control input-sm" disabled placeholder="IndikatorenName"
								ng-model="tmpGeoresourceSelection.datasetName">
							<div class="help-block with-errors"></div>
						</div>
					</div>
				</div>

				<div class="row vertical-align">
					<div class="col-md-3 col-sm-6 col-xs-12">
						<div class="form-group">
							<button class="btn btn-success btn-sm" ng-disabled="!tmpGeoresourceSelection"
								ng-click="$ctrl.kommonitorScriptHelperServiceInstance.addBaseGeoresource(tmpGeoresourceSelection)">Hinzuf&uuml;gen</button>
							<div class="help-block with-errors"></div>
						</div>
					</div>
				</div>

				<br />
				<br />

				<!-- Table to display currently specified base georesources -->
				<div class="row vertical-align">
					<div class="col-md-12 col-sm-12 col-xs-12">
						<label>&Uuml;bersicht der definierten Georessourcen</label>
						<table class="table table-condensed">
							<thead>
								<tr>
									<th>Editierfunktionen</th>
									<th>Geometrie-Typ</th>
									<th>ID der Georessource</th>
									<th>Name der Georessource</th>
									<th>Beschreibung</th>
								</tr>
							</thead>
							<tbody>
								<tr
									ng-repeat="baseGeoresource in $ctrl.kommonitorScriptHelperServiceInstance.requiredGeoresources_tmp">
									<td>
										<div class="btn-group btn-group-sm">
											<button class="btn btn-danger btn-sm" type="button"
												ng-click="$ctrl.kommonitorScriptHelperServiceInstance.removeBaseGeoresource(baseGeoresource)"
												title="Eintrag l&ouml;schen"><i class="fas fa-trash"></i></button>
										</div>
									</td>
									<td>
										<div ng-if="baseGeoresource.isPOI">
											<i class="fas fa-map-marker-alt"></i>
										</div>
										<div ng-if="baseGeoresource.isLOI">
											<i class="fas fa-minus"></i>
										</div>
										<div ng-if="baseGeoresource.isAOI">
											<i class="fas fa-square"></i>
										</div>
									</td>
									<td>{{baseGeoresource.georesourceId}}</td>
									<td>{{baseGeoresource.datasetName}}</td>
									<td>{{baseGeoresource.metadata.description}}</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>


			</div>
			<!-- Box Body -->
		</div>
		<!-- Box -->

		<!-- </div>	 -->

	</div>

</div>

<p>Skript-Parameter sind optional und dienen dazu, variable Berechnungsparameter zu definieren (bspw. Radius eines
	Einzugsgebiets, Gewichtung). Jeder der definierten Skript-Parameter sollte im Skript-Code auch Verwendung finden.
</p>

<div class="row vertical-align">
	<div class="col-md-10 col-sm-12 col-xs-12">
		<!-- <div style="text-align: left;"> -->
		<div class="box box-danger collapsed-box" style="background: #ebf0fd;">
			<div class="box-header">
				<h3 class="box-title">Optionale Skript-Parameter</h3>

				<div class="box-tools pull-right">
					<button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-plus"></i>
					</button>
				</div>
			</div>
			<!-- /.box-header -->
			<div class="box-body">

				<!-- Inputs for new reference -->

				<p>Ein Skript-Parameter besteht aus einem <b>Namen</b>, einer <b>Beschreibung</b>, einem festgelegten
					<b>Datentyp</b>, und einem <b>Standard-Wert</b>. Bei numerischen Parametern kann dar√ºber hinaus der
					g&uuml;ltige Wertebereich festgelegt werden.</p>

				<div class="row vertical-align">
					<div class="col-md-4 col-sm-6 col-xs-12">
						<div class="form-group">
							<label>Parametername*</label>
							<input type="text" class="form-control" ng-model="parameterName_tmp" placeholder="Name"
								required></input>
							<div class="help-block with-errors"></div>
							<div class="help-block">
								<p>Name des anzulegenden Skript-Parameters.</p>

							</div>
						</div>
					</div>
					<div class="col-md-8 col-sm-6 col-xs-12">
						<div class="form-group">
							<label>Beschreibung*</label>
							<textarea rows="3" type="text" class="form-control" ng-model="parameterDescription_tmp"
								placeholder="Beschreibung" required></textarea>

							<div class="help-block">
								<p>Hinweise &uuml;ber die Verwendung des Parameters innerhalb des
									Skripts</p>
							</div>
							<div class="help-block with-errors"></div>
						</div>
					</div>

				</div>

				<div class="row vertical-align">
					<div class="col-md-3 col-sm-6 col-xs-12">
						<div class="form-group">
							<label>Datentyp des Parameters*</label>
							<select ng-model="parameterDataType_tmp" size="5"
								ng-options="dataType as dataType.displayName for dataType in $ctrl.kommonitorScriptHelperServiceInstance.availableScriptDataTypes"
								ng-change="onChangeParameterDataType()"
								class="form-control">
								<option disabled selected value> -- Parameter-Datentyp w&auml;hlen --
								</option>
							</select>
							<div class="help-block with-errors"></div>
						</div>
					</div>
					<div class="col-md-3 col-sm-6 col-xs-12">
						<div class="form-group">
							<label>Standard-Wert*</label>
							<div ng-if="parameterDataType_tmp.apiName === 'string'">
								<input type="text" class="form-control" ng-model="parameterDefaultValue_tmp" 
									placeholder="textueller Standard-Wert"
									ng-change="onChangeDefaultValue(parameterDefaultValue_tmp)" required></input>
							</div>
							<div ng-if="parameterDataType_tmp.apiName === 'boolean'">
								<input type="checkbox" ng-model="parameterDefaultValue_tmp"
									ng-change="onChangeDefaultValue(parameterDefaultValue_tmp)" required></input>
							</div>
							<div ng-if="parameterDataType_tmp.apiName === 'integer'">
								<input type="number" step="1" class="form-control" ng-model="parameterDefaultValue_tmp" 
									ng-change="onChangeDefaultValue(parameterDefaultValue_tmp)"
									placeholder="Ganzzahl Standard-Wert" required></input>
							</div>
							<div ng-if="parameterDataType_tmp.apiName === 'double'">
								<input type="number" step="0.000000001" class="form-control"
									ng-model="parameterDefaultValue_tmp" 
									ng-change="onChangeDefaultValue(parameterDefaultValue_tmp)"
									placeholder="Gleitkommazahl Standard-Wert" required></input>
								<div class="help-block">
									<p>Maximal 8 Nachkommastellen.</p>

								</div>
							</div>

							<div class="help-block with-errors"></div>
							<div class="help-block">
								<p>Standard-Wert des anzulegenden Skript-Parameters, dessen Wert bei automatisierten
									Indikatoren-Zeitreihen-Fortf&uuml;hrung f&uuml;r diesen Parameter gesetzt wird.</p>

							</div>
						</div>
					</div>
					<div class="col-md-3 col-sm-6 col-xs-12" ng-if="parameterDataType_tmp.apiName === 'integer'">
						<div class="form-group">
							<label>Minimaler Wert (untere G&uuml;ltigkeitsgrenze)*</label>
							<div>
								<input type="number" step="1" class="form-control"
									ng-model="parameterNumericMinValue_tmp"
									ng-change="onChangeNumericMinValue(parameterNumericMinValue_tmp)"
									placeholder="Ganzzahl Min-Wert"></input>
							</div>

							<div class="help-block with-errors"></div>
							<div class="help-block">
								<p>Minimaler Wert des anzulegenden numerischen Skript-Parameters im Sinne eines
									G&uuml;ltigkeitsbereichs. Maximal 8 Nachkommastellen</p>

							</div>
						</div>
					</div>
					<div class="col-md-3 col-sm-6 col-xs-12" ng-if="parameterDataType_tmp.apiName === 'integer'">
						<div class="form-group">
							<label>Maximaler Wert (obere G&uuml;ltigkeitsgrenze)*</label>
							<div>
								<input type="number" step="1" class="form-control"
									ng-model="parameterNumericMaxValue_tmp"
									ng-change="onChangeNumericMaxValue(parameterNumericMaxValue_tmp)"
									placeholder="Ganzzahl Max-Wert"></input>
							</div>

							<div class="help-block with-errors"></div>
							<div class="help-block">
								<p>Maximaler Wert des anzulegenden numerischen Skript-Parameters im Sinne eines
									G&uuml;ltigkeitsbereichs. Maximal 8 Nachkommastellen</p>

							</div>
						</div>
					</div>
					<div class="col-md-3 col-sm-6 col-xs-12" ng-if="parameterDataType_tmp.apiName === 'double'">
						<div class="form-group">
							<label>Minimaler Wert (untere G&uuml;ltigkeitsgrenze)*</label>
							<div>
								<input type="number" step="0.000000001" class="form-control"
									ng-model="parameterNumericMinValue_tmp"
									ng-change="onChangeNumericMinValue(parameterNumericMinValue_tmp)"
									placeholder="Gleitkommazahl Min-Wert"></input>
							</div>

							<div class="help-block with-errors"></div>
							<div class="help-block">
								<p>Minimaler Wert des anzulegenden numerischen Skript-Parameters im Sinne eines
									G&uuml;ltigkeitsbereichs. Maximal 8 Nachkommastellen</p>

							</div>
						</div>
					</div>
					<div class="col-md-3 col-sm-6 col-xs-12" ng-if="parameterDataType_tmp.apiName === 'double'">
						<div class="form-group">
							<label>Maximaler Wert (obere G&uuml;ltigkeitsgrenze)*</label>
							<div>
								<input type="number" step="0.000000001" class="form-control"
									ng-model="parameterNumericMaxValue_tmp"
									ng-change="onChangeNumericMaxValue(parameterNumericMaxValue_tmp)"
									placeholder="Gleitkommazahl Max-Wert"></input>
							</div>

							<div class="help-block with-errors"></div>
							<div class="help-block">
								<p>Maximaler Wert des anzulegenden numerischen Skript-Parameters im Sinne eines
									G&uuml;ltigkeitsbereichs. Maximal 8 Nachkommastellen</p>

							</div>
						</div>
					</div>
				</div>

				<div class="row vertical-align">
					<div class="col-md-3 col-sm-6 col-xs-12">
						<div class="form-group">
							<button class="btn btn-success btn-sm"
								ng-disabled="!parameterDataType_tmp || parameterDefaultValue_tmp == undefined || !parameterName_tmp || !parameterDescription_tmp"
								ng-click="onAddScriptParameter()">Hinzuf&uuml;gen</button>
							<div class="help-block with-errors"></div>
						</div>
					</div>
				</div>

				<br />
				<br />

				<!-- Table to display currently specified base georesources -->
				<div class="row vertical-align">
					<div class="col-md-12 col-sm-12 col-xs-12">
						<label>&Uuml;bersicht der definierten Skript-Parameter</label>
						<table class="table table-condensed">
							<thead>
								<tr>
									<th>Editierfunktionen</th>
									<th>Name der Georessource</th>
									<th>Beschreibung</th>
									<th>Datentyp</th>
									<th>Standard-Wert</th>
									<th>Min-Wert</th>
									<th>Max-Wert</th>
								</tr>
							</thead>
							<tbody>
								<tr
									ng-repeat="scriptParameter in $ctrl.kommonitorScriptHelperServiceInstance.requiredScriptParameters_tmp">
									<td>
										<div class="btn-group btn-group-sm">
											<button class="btn btn-danger btn-sm" type="button"
												ng-click="$ctrl.kommonitorScriptHelperServiceInstance.removeScriptParameter(scriptParameter)"
												title="Eintrag l&ouml;schen"><i class="fas fa-trash"></i></button>
										</div>
									</td>
									<td>
										{{scriptParameter.name}}
									</td>
									<td>{{scriptParameter.description}}</td>
									<td>{{scriptParameter.dataType}}</td>
									<td>{{scriptParameter.defaultValue}}</td>
									<td>
										<div
											ng-if="scriptParameter.dataType === 'integer' || scriptParameter.dataType === 'double'">
											{{scriptParameter.minParameterValueForNumericInputs}}
										</div>
									</td>
									<td>
										<div
											ng-if="scriptParameter.dataType === 'integer' || scriptParameter.dataType === 'double'">
											{{scriptParameter.maxParameterValueForNumericInputs}}
										</div>
									</td>

								</tr>
							</tbody>
						</table>
					</div>
				</div>


			</div>
			<!-- Box Body -->
		</div>
		<!-- Box -->

		<!-- </div>	 -->

	</div>

</div>

<p>Der eigentliche Skript Code kann beliebige Berechnungslogik enthalten. Unter Verwendung der obigen
	(Basis-)Indikatoren, Georessourcen und Skript-Parameter kann mittels des hinterlegten Skript Codes die Zeitreihe des
	Ziel-Indikators berechnet werden.</p>
<p><b>HINWEIS:</b> Die hier angegebenen Skript-Inhalte werden nicht validiert oder auf Code-Fehler &uuml;berpr&uuml;ft.
	Bitte achten Sie selbst sorgf&auml;ltig darauf, dass der hochzuladende Code g&uuml;ltig ist.</p>

<div class="row vertical-align">
	<div class="col-md-10 col-sm-12 col-xs-12">
		<!-- <div style="text-align: left;"> -->
		<div class="box box-danger collapsed-box" style="background: #ebf0fd;">
			<div class="box-header">
				<h3 class="box-title">Skript Code (gem&auml;&szlig; Skript Template)</h3>

				<div class="box-tools pull-right">
					<button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-plus"></i>
					</button>
				</div>
			</div>
			<!-- /.box-header -->
			<div class="box-body">

				<!-- Inputs for new reference -->

				<div class="row vertical-align">
					<div class="col-md-3 col-sm-6 col-xs-12">
						<div class="form-group">
							<label>Einladen des Skript Codes aus einer Datei:</label>
							<!-- <button type="button" class="btn btn-info" ng-click="onImportScriptCodeFile()"
								title="Importieren des Skript Codes aus einer Datei"><i
									class="fas fa-file-import"></i>&nbsp;&nbsp;Skript Code Import</button> -->
							<input class="pull-left" type="file" class="form-control"
								id="scriptCodeImportFile" accept=".js,"></input>
							<div class="help-block with-errors"></div>
							<div class="help-block">
								Der Skript Code muss als Klartext Javascript Datei hochgeladen werden
							</div>
						</div>
					</div>
				</div>

				<div class="row vertical-align">
					<div class="col-md-12 col-sm-12 col-xs-12">
						<div class="form-group">
							<label>Vorschaufenster des Skript-Codes*</label>
							<br/>
							<br/>
							<pre ng-show="scriptCode_readableString_forPreview" class="prettyprint linenums" style="max-height: 450px; overflow: auto; text-align: left;" id="scriptCodePreview"><code class="language-javascript" ng-bind-html="scriptCode_readableString_forPreview"></code></pre>
						</div>
					</div>
				</div>


			</div>
			<!-- Box Body -->
		</div>
		<!-- Box -->

		<!-- </div>	 -->

	</div>

</div>

<div id="scriptAddScriptCodeImportErrorAlert" style="position: absolute; bottom: 0px; width: 100%;" hidden
	class="alert alert-danger alert-dismissable">
	<button type="button" class="close" ng-click="hideScriptCodeErrorAlert()" aria-hidden="true">&times;</button>
	<h4><i class="icon fa fa-ban"></i>Script Code Import gescheitert</h4>
	Beim Import des Script Codes aus einer Datei ist ein Fehler aufgetreten. Fehlermeldung:
	<br />
	<pre>{{indicatorScriptCodeImportError}}</pre>
	<br />
	<br />
	<p>Bitte stellen Sie sicher, dass <a
		href="./kommonitor-script-resources/kommonitor-script-template.js"
		rel='noopener noreferrer' target='_blank'>KomMonitor Skript Template</a> eingehalten wird und die Datei den Code als einfachen String enth&auml;lt</p>
</div>