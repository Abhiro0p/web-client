<div class="modal fade" id="modal-add-ou" role="dialog">
	<div class="modal-dialog modal-xl">
		<div class="modal-content">

			<div align="center">
				<div class="loading-overlay-admin-panel ng-hide" ng-show="loadingData">
					<span class="glyphicon glyphicon-refresh icon-spin"></span>
				</div>
			</div>


			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span></button>
				<h4 class="modal-title">Neue Organisationseinheit registrieren</h4>
			</div>
			<div class="modal-body">

				<!-- MultiStep Form -->
				<div class="row">
					<div class="col-md-12">
						<form class="multiStepForm form-group" id="ouAddForm" role="form" data-toggle="validator"
							data-disable="true" style="margin-bottom: 0px;">
							<!-- div required for click logic -->
							<div> 
								<!-- progressbar -->
								<ul id="progressbar">
									<li style="width: 50%;" class="active">Basisinformationen</li>
									<li style="width: 50%;">Gruppenspezifische Rechte</li>
								</ul>
							</div>							
							<!-- fieldsets -->
							<fieldset>
								<h2 class="fs-title">Basisinformationen</h2>
								<h3 class="fs-subtitle">Angaben &uuml;ber die neue Organisationseinheit</h3>
								<p><b><i>* = Pflichtfeld</i></b></p>

								<div class="row vertical-align">
									<div class="col-md-4">
										<label>Name*</label>
										<input style="width:100%;" class="form-control" type="text"
											placeholder="z.B. Fachbereich 52" ng-model="newOrganizationalUnit.name"
											ng-change="checkOrganizationalUnitName()" required></input>
										<div class="help-block with-errors"></div>
										<div ng-if="nameInvalid" style="color: red;">
											<p>Eingabe ung&uuml;ltig. Es existiert bereits eine andere Organisationseinheit mit gleichem Namen.</p>
										</div>
									</div>
									<div class="col-md-4">
										<label>Beschreibung*</label>
										<textarea style="width:100%;" class="form-control" type="text" rows="4"
											placeholder="z.B. Abteilung 52 von Musterstadt" ng-model="newOrganizationalUnit.description" required></textarea>
									</div>
									<div class="col-md-4">
										<label>Kontakt*</label>
										<textarea style="width:100%;" class="form-control" type="text" rows="4"
											placeholder="z.B. sekretariat@kommonitor.de" ng-model="newOrganizationalUnit.contact" required></textarea>
									</div>
								</div>
								<div class="row vertical-align" style="height:20em">
									<div class="col-md-4" ng-if="$ctrl.kommonitorDataExchangeServiceInstance.isRealmAdmin">
                    					<div ng-if="parentSelected" class="alert alert-info">
                      						Zum Anlegen eines Mandanten deselektieren Sie bitte die &uuml;bergeordnete Organisationseinheit
                    					</div>
										<div class="form-group" ng-if="!parentSelected">
											<label>Mandant*</label>
											<label class="switch">
												<input type="checkbox" ng-model="newOrganizationalUnit.mandant">
												<span class="switchslider round"></span>
											</label>
											<div class="help-block">
												<p>Mandanten besitzen alle Rechte sich und Ihre Daten selbst zu verwalten. Als Mandant markierte Organisationseinheiten haben die M&ouml;glichkeit, eigene Themenb&auml;me, Raumeinheiten und User zu verwalten.
													Sind sie hierarchisch anderen Organisationseinheiten untergeordnet, k&ouml;nnen auch &uuml;bergeordnete Organisationseinheiten diesen Mandanten mitverwalten, wenn dieser es in Keycloak explizit erlaubt.
												</p>
											</div>
										</div>
									</div>	
									<div class="col-md-4">
										<label for="parentOrganizationalUnitSelect"><b>Hierarchische Einordnung - Angabe der &uuml;bergeordneten Organisationseinheit</b></label>
                      					<div ng-if="newOrganizationalUnit.mandant" class="alert alert-info">
                        					Mandanten k&ouml;nnen keine &uuml;bergeordnete Organisationseinheit haben
                      					</div>
                      					<div ng-if="!newOrganizationalUnit.mandant">
                        					<div class="input-group">
                          						<span class="input-group-addon"><i class="fas fa-filter"></i></span>
                          							<input type="text" class="form-control input-sm" placeholder="Stichwortfilter" ng-model="parentOrganizationalUnitFilter" ng-model-options="{debounce: 500, blur: 0}">
                        					</div>
                        					<select id="parentOrganizationalUnitSelect" size="5" ng-model="parentOrganizationalUnit" 
                          						class="form-control" ng-change="onChangeParentOrganizationalUnit(parentOrganizationalUnit)" 
                          						ng-options="organizationalUnitItem as organizationalUnitItem.name for organizationalUnitItem in $ctrl.kommonitorDataExchangeServiceInstance.allowedAccessControl | filter:parentOrganizationalUnitFilter | filter:$ctrl.kommonitorDataExchangeServiceInstance.filterChildOrSelfOrganizationalUnits()"
                          						required>
                          						<option selected value ng-if="$ctrl.kommonitorDataExchangeServiceInstance.isRealmAdmin"><b>keine - neuer Wurzelknoten</b></option>		
                        					</select>
                        				<div class="help-block">
                          					<p>wird keine &uuml;bergeordneten Organisationseinheit festgelegt, so ist die neue Organisationseinheit auf oberster Ebene der Hierarchie angesiedelt. 
                            					Die Hierarchiebeziehung kann nachtr&auml;glich angepasst werden.  
                          					</p>
                        				</div>
                      				</div>
								</div>		
								<!-- <input type="button" name="next" class="next next_addRole action-button" value="N&auml;chster Schritt"/>	 -->
							</fieldset>
                            <fieldset>
								<h2 class="fs-title">Delegierte administrative Rechte</h2>
								<h3 class="fs-subtitle">Administrative Rechte können hier an andere Gruppen übertragen werden.</h3>
		
								<div class="row vertical-align">

									<div class="col-md-12 col-sm-12 col-xs-12">
                                        <div id="addRoleEditGroupRoleManagementTable" style="height: 45vh" class="ag-theme-alpine"></div>
									</div>

								</div>

								<input type="button" name="previous"
									class="previous previous_editIndicatorRoles action-button-previous"
									value="Voriger Schritt" />											
							</fieldset>

						</form>
					</div>
				</div>
				<!-- /.MultiStep Form -->

			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default pull-left" data-dismiss="modal">Schlie&szlig;en</button>

				<button type="button" class="btn btn-success" type="submit" ng-click="addOrganizationalUnit()"
					ng-disabled="!newOrganizationalUnit.name || !newOrganizationalUnit.description || !newOrganizationalUnit.contact || nameInvalid || (!newOrganizationalUnit.mandant && !newOrganizationalUnit.parentId) || (newOrganizationalUnit.mandant && newOrganizationalUnit.parentId)">Gruppe registrieren</button>
				<button type="button" class="btn btn-danger" ng-click="resetOrganizationalUnitAddForm()">Zur&uuml;cksetzen</button>
			</div>

			<div id="ouAddSuccessAlert" style="position: absolute; bottom: 0px; width: 100%;" hidden
				class="alert alert-success alert-dismissable">
				<button type="button" class="close" ng-click="hideSuccessAlert()" aria-hidden="true">&times;</button>
				<h4><i class="icon fa fa-check"></i>Organisationseinheit in KomMonitor Datenbank registriert</h4>
				<p>Eine neue Einheit mit Namen {{newOrganizationalUnit.name}} wurde in KomMonitor registriert und in die
					&Uuml;bersichtstabelle eingetragen.
				</p>
			</div>

			<div id="ouAddErrorAlert" style="position: absolute; bottom: 0px; width: 100%;" hidden
				class="alert alert-danger alert-dismissable">
				<button type="button" class="close" ng-click="hideErrorAlert()" aria-hidden="true">&times;</button>
				<h4><i class="icon fa fa-ban"></i>Registrierung in KomMonitor Datenbank gescheitert</h4>
				Bei der Registrierung der Organisationseinheit in der KomMonitor Datenbank ist ein Fehler aufgetreten. Fehlermeldung:
				<br />
				<pre style="overflow:auto; max-height:500px;" ng-bind-html="errorMessagePart"></pre>
				<br />
				<br />
			</div>

			<div id="keycloakGroupAddSuccessAlert" style="position: absolute; bottom: 0px; width: 100%;" hidden
				class="alert alert-success alert-dismissable">
				<button type="button" class="close" ng-click="hideKeycloakSuccessAlert()" aria-hidden="true">&times;</button>
				<h4><i class="icon fa fa-check"></i>Gruppe in Keycloak registriert</h4>
				<p>{{newOrganizationalUnit.name}} wurde in Keycloak als Gruppe registriert. Weiterhin wurden gruppen-spezifische Administratorrollen in Keycloak angelegt, die mit Usern oder Gruppen verkn&uuml;pft werden k&ouml;nnen. In Keycloak k&ouml;nnen nun User verkn&uuml;pt werden.
					<a ng-href="{{$ctrl.kommonitorKeycloakHelperServiceInstance.targetUrlToKeycloakInstance}}" target="_blank" rel="noopener noreferrer">{{$ctrl.kommonitorKeycloakHelperServiceInstance.targetUrlToKeycloakInstance}}</a>
				</p>
			</div>

			<div id="keycloakGroupAddErrorAlert" style="position: absolute; bottom: 0px; width: 100%;" hidden
				class="alert alert-danger alert-dismissable">
				<button type="button" class="close" ng-click="hideKeycloakErrorAlert()" aria-hidden="true">&times;</button>
				<h4><i class="icon fa fa-ban"></i>Registrierung in Keycloak gescheitert</h4>
				Bei der Registrierung in Keycloak ist ein Fehler aufgetreten. Fehlermeldung:
				<br />
				<pre style="overflow:auto; max-height:500px;" ng-bind-html="keycloakErrorMessagePart"></pre>
				<br />
				<br />
				Die Gruppe kann auch direkt in der Keycloak Administrationsseite angelegt werden. Besuchen Sie dazu				
					<a ng-href="{{$ctrl.kommonitorKeycloakHelperServiceInstance.targetUrlToKeycloakInstance}}" target="_blank" rel="noopener noreferrer">{{$ctrl.kommonitorKeycloakHelperServiceInstance.targetUrlToKeycloakInstance}}</a>
					Dort k&ouml;nnen dann auch Nutzer mit der Rolle verkn&uuml;pt werden.
			</div>

		</div>
		<!-- /.modal-content -->
	</div>
	<!-- /.modal-dialog -->
</div>
<!-- /.modal -->