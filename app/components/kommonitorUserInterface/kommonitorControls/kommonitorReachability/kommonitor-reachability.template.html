<div id="kommonitorReachability">

	<div align="center">
		<div class="loading-overlay-sidebar-small ng-hide" ng-show="settings.loadingData">
			<span class="glyphicon glyphicon-refresh icon-spin"></span>
		</div>
	</div>

	<p></p>

	<div class="box box-primary">
		<div class="box-header with-border">
			<h3 class="box-title">Erreichbarkeitsanalysen</h3>
			<p style="margin: 0 0 0px;">auf Basis von Stra&szlig;en- und Wegenetzen mittels OpenRouteService</p>

			<div class="box-tools pull-right">
				<button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
				</button>
			</div>
		</div>
		<!-- /.box-header -->

		<div class="box-body">
			<!-- <label for="TODO">Berechnungsaufgabe:</label> -->

			<div id="reachabiltiy-method-btn-group" class="btn-group btn-group-justified" data-toggle="buttons">
				<label class="btn btn-primary active">
					<input type="radio" name="btn_show_iso" id="btn_isochrones" ng-change="showIso()" autocomplete="off"
						checked ng-model="showIsochrones" value="true"><i class="far fa-dot-circle"></i>
					Einzugsgebiet</input>
				</label>
				<label class="btn btn-primary">
					<input type="radio" name="btn_show_rout" id="btn_routing" ng-change="showRouting()"
						autocomplete="off" ng-model="showIsochrones" value="false"><i class="fas fa-route"></i>
					Routing</input>
				</label>
			</div>
			<!--
								<label>showIsochrones= {{showIsochrones}}, transitMode= {{settings.transitMode}}</label>
							 -->

			<div class="just-padding">

				<br />
							<div class="btn-group btn-group-justified" data-toggle="buttons">
									<label class="btn btn-primary active" ng-show="showIsochrones">
										<input type="radio" name="options" id="optBuffer" autocomplete="off" checked
											ng-change="changeType()" ng-model="settings.transitMode" value="buffer"> <i
											class="far fa-dot-circle"></i> Puffer</input>
									</label>
								<label class="btn btn-primary" id="optFeetRadioButtonLabel">
									<input type="radio" name="options" id="optFeet" autocomplete="off" checked
										ng-change="changeType()" ng-model="settings.transitMode" value="foot-walking"> <i
										class="fas fa-walking"></i> Fu&szlig;g&aumlnger </input>
								</label>
								<label class="btn btn-primary">
									<input type="radio" name="options" id="optBike" autocomplete="off"
										ng-change="changeType()" ng-model="settings.transitMode" value="cycling-regular"> <i
										class="fas fa-biking"></i> Fahrrad </input>
								</label>
								<label class="btn btn-primary">
									<input type="radio" name="options" id="optCar" autocomplete="off"
										ng-change="changeType()" ng-model="settings.transitMode" value="driving-car"> <i
										class="fas fa-car"></i> PKW </input>
								</label>
								<label class="btn btn-primary">
									<input type="radio" name="options" id="optWheelchair" autocomplete="off"
										ng-change="changeType()" ng-model="settings.transitMode" value="wheelchair"> <i
										class="fab fa-accessible-icon"></i> Barrierefrei </input>
								</label>
							</div>

			</div>

			<div ng-show="showIsochrones" class="ng-show" id="isochoneCalculation">

						<div class="just-padding">

							<!-- <label for="TODO">Analysefokus</label> -->

							<br />

							<div class="btn-group btn-group-justified" data-toggle="buttons">
								<label class="btn btn-primary active">
									<input type="radio" name="options" id="focus_distance" autocomplete="off" checked
										ng-change="changeFocus('distance')" ng-model="settings.focus" value="distance"> <i
										class="fas fa-ruler"></i> Distanz
								</label>
								<label class="btn btn-primary" ng-disabled="settings.transitMode === 'buffer'">
									<input type="radio" name="options" id="focus_time" autocomplete="off"
										ng-change="changeFocus('time')" ng-model="settings.focus" value="time"><i
										class="far fa-clock"></i> Zeit
								</label>
							</div>

							<!--
											<label>Fokus= {{settings.focus}}, Time= {{isTime}}</label>
										-->

							<br />
							<hr>
							<br />

							<div >

								
										<label>Allgemeine Hinweise</label>

										<p>je h&ouml;her die Anzahl der Startpunkte/Isochonen oder die Distanz/Zeit pro Isochrone, desto l&auml;nger dauert die Analyse</p>																												

										<br/>

										<label>Isochronendefinition</label>
										<p>Geben Sie die gew&uuml;nschten Isochronengrenzen kommagetrennt ein
											(Beispiel: '100,200,300' in Metern oder '5,10,20' f&uuml;r Minuten).</p>
										<div>
											<input ng-model="settings.isochroneInput" type="text" style="width:95%;" placeholder="Isochronengrenzen angeben" onkeypress="isInputAllowed(event)">
										</div>

										<br/>
										<br/>

										<div ng-if="!isTime">
											<label>Voreinstellungsoptionen</label>

											<br/>
																						
												<label class="radio-inline"><input type="radio" name="distances" value="100,200,300,400,500" ng-model="settings.isochroneInput" ng-click="settings.isochroneInput = '100,200,300,400,500'"> 100,200,300,400,500 Meter</label>
											  												
												<label class="radio-inline"><input type="radio" name="distances" value="500,1000,1500" ng-model="settings.isochroneInput" ng-click="settings.isochroneInput = '500,1000,1500'"> 500,1000,1500 Meter</label>
											   
										</div>

										<div ng-if="isTime">
											<label>Voreinstellungsoptionen</label>

											<br/>
																						
												<label class="radio-inline"><input type="radio" name="times" value="5,10,15" ng-model="settings.isochroneInput" ng-click="settings.isochroneInput = '5,10,15'" > 5,10,15 Minuten</label>
											  											
												<label class="radio-inline"><input type="radio" name="times" value="5,10,15,20,25" ng-model="settings.isochroneInput" ng-click="settings.isochroneInput = '5,10,15,20,25'" >5,10,15,20,25 Minuten</label>
											  
										</div>

										<script>
											function isInputAllowed(evt) {
												var code = (evt.keyCode ? evt.keyCode : evt.which);
												if (code == 8) { //Backspace key press
													return true;
												} else {
													var ch = String.fromCharCode(evt.which);
													if (!(/[0-9,]/.test(ch))) {
														evt.preventDefault();
													}
												}
											}
										</script>
									<!-- </div>
								</div>								 -->
								<!-- <br />
											<br /> -->

							</div>

							<br />

							<hr>
							<br />
							<div>
								
							</div>
							<div ng-show="!isUsedInReporting">
								<label for="TODO">Startpunkte</label>

								<br />
	
								<div class="btn-group btn-group-justified " data-toggle="buttons">
									<label class="btn btn-primary active">
										<input type="radio" name="options" id="startPointsSource_layer" autocomplete="off"
											checked ng-change="changeStartPointsSource_fromLayer()" ng-model="settings.startPointsSource"
											value="fromLayer"><i class="fas fa-layer-group"></i> aus Punkt-Layer</input>
									</label>
									<label id="reachability-draw-points-btn" class="btn btn-primary">
										<input type="radio" name="options" id="startPointsSource_draw" autocomplete="off"
											ng-change="changeStartPointsSource_manual()" ng-model="settings.startPointsSource"
											value="manual"><i class="fas fa-map-marked-alt"></i> Punkte zeichnen</input>
									</label>
								</div>
	
								<!--
												<label>Fokus= {{settings.focus}}, Time= {{isTime}}</label>
											-->
	
								<br />
	
								<div ng-show="settings.startPointsSource === 'fromLayer'">
	
									<label>Art der Datumsdefinition zum Abruf eines Datensatzes</label>
									<div class="form-group">
										<label class="radio-inline"><input type="radio" name="settings.isochroneConfig.dateSelectionType"  ng-value="settings.isochroneConfig.dateSelectionType_valueIndicator" ng-model="settings.isochroneConfig.dateSelectionType.selectedDateType" ng-change="!isUsedInReporting && fetchGeoJSONForIsochrones()" >Datum des aktuellen Indikators</label>
										<label class="radio-inline"><input type="radio" name="settings.isochroneConfig.dateSelectionType"  ng-value="settings.isochroneConfig.dateSelectionType_valueManual" ng-model="settings.isochroneConfig.dateSelectionType.selectedDateType">manuelles Datum
											<div ng-hide="!(settings.isochroneConfig.dateSelectionType.selectedDateType === settings.isochroneConfig.dateSelectionType_valueManual)" class="input-group date">
												<div class="input-group-addon">
													<i class="far fa-calendar-alt"></i>
												</div>
												<input type="text" ng-model="settings.isochroneConfig.selectedDate_manual" ng-change="onChangeManualDate_isochroneConfig()" ng-model-options="{debounce: 500, blur: 0}"
													class="form-control pull-right" placeholder="YYYY-MM-DD"
													id="manualDateDatepicker_reachabilityConfig" required>
											</div>
										</label>
										<label class="radio-inline"><input type="radio" name="settings.isochroneConfig.dateSelectionType"  ng-value="settings.isochroneConfig.dateSelectionType_valuePerDataset" ng-model="settings.isochroneConfig.dateSelectionType.selectedDateType" ng-change="onClickPerDataset_isochroneConfig()" >pro Datensatz</label>
									</div>
	
									<br/>
	
									<div class="row vertical-align" style="margin-right:0px;">
										<div class="col-md-6 col-sm-6 col-xs-6">
											<div class="horizontal-align" ng-show="settings.selectedStartPointLayer.geoJSON">
												<p><b>{{settings.selectedStartPointLayer.geoJSON.features.length}}</b> Startpunkte im
													selektierten Layer</p>
											</div>
	
											<div class="horizontal-align" ng-hide="settings.selectedStartPointLayer">
												<p>noch kein Layer selektiert</p>
											</div>
	
											<div class="horizontal-align" ng-if="settings.selectedStartPointLayer && ! settings.selectedStartPointLayer.geoJSON">
												<p style="color: red;">zum angegebenen Zeitwert konnten keine validen Feature-Daten abgerufen werden</p>
											</div>
										</div>
										<div class="col-md-6 col-sm-6 col-xs-6">
											<select style="font-size: 12px;" ng-model="settings.selectedStartPointLayer"
												ng-options="poi as poi.datasetName for poi in $ctrl.kommonitorDataExchangeServiceInstance.displayableGeoresources | filter:$ctrl.kommonitorDataExchangeServiceInstance.filterGeoresourcesByPoi() | filter:$ctrl.kommonitorDataExchangeServiceInstance.filterPois()"
												ng-change="onChangeSelectedStartPointLayer()" class="form-control" required>
												<option disabled selected value> -- Punkt-Layer w&auml;hlen -- </option>
											</select>
	
											<div ng-if="settings.selectedStartPointLayer && settings.isochroneConfig.dateSelectionType.selectedDateType === settings.isochroneConfig.dateSelectionType_valuePerDataset">
												<select style="font-size: 11px; width:135px; padding: 0px;"
														ng-model="settings.isochroneConfig.selectedDate" ng-change="!isUsedInReporting && fetchGeoJSONForIsochrones()" ng-options="date as date.startDate for date in settings.selectedStartPointLayer.availablePeriodsOfValidity | orderBy: 'startDate' | unique: 'startDate'" ng-init="settings.isochroneConfig.selectedDate = settings.selectedStartPointLayer.availablePeriodsOfValidity[settings.selectedStartPointLayer.availablePeriodsOfValidity.length - 1]"
														class="form-control" required>
												</select>
											</div>										
										</div>
									</div>
								</div>
	
								<div ng-show="settings.startPointsSource === 'manual'">
	
									<p>Zeichnen Sie selbst Punkte in die Karte. Dazu nutzen Sie bitte das Zeichen-Werkzeug
										in der unteren linken Ecke der Karte.</p>
	
									<div class="row vertical-align" style="margin-right:0px;">
										<div class="col-md-6 col-sm-6 col-xs-6">
											<div class="horizontal-align" ng-show="manualStartPoints.features.length > 0">
												<p><b>{{manualStartPoints.features.length}}</b> Startpunkte gezeichnet</p>
											</div>
	
											<div class="horizontal-align" ng-hide="manualStartPoints.features.length > 0">
												<p>noch keine Start-Punkte gezeichnet</p>
											</div>
										</div>
										<div class="col-md-6 col-sm-6 col-xs-6">
											<button type="button" class="btn btn-danger btn-sm"
												ng-click="removeAllDrawnPoints()">Punkte entfernen</button>
										</div>
									</div>
								</div>

								<br />
								<hr>
								<br />	
							</div>

							<div align="center">

								<div ng-show="showIsochrones">
									<b>Isochronen vereinigen</b> (erh&ouml;ht die Laufzeit der Berechnung)
									&nbsp;
									<label class="switch">
										<input type="checkbox" value="settings.dissolveIsochrones" ng-model="settings.dissolveIsochrones"
											checked>
										<span class="switchslider round"></span>
									</label>
									<br />
									<br />
								</div>

								<input type="button" class="btn btn-s btn-info" value="Analyse starten!"
									ng-disabled="!(pointSourceConfigured && settings.isochroneInput && showIsochrones)"
									ng-click="startAnalysis()"></input>
								<input type="button" class="btn btn-s btn-danger" value="Zur&uuml;cksetzen"
									ng-click="resetForm()"></input>
							</div>

							<div ng-show="showIsochrones && $ctrl.kommonitorDataExchangeServiceInstance.isochroneLegend">
								<br/>
								<br/>
								<div style="display: inline-block" align="center" id="reachabilityIsochroneButtonSection">
									<button ng-click="removeReachabilityLayers()" type="button" class="btn btn-danger">Ergebnis
										verwerfen / Layer entfernen</button>
									<!-- another button to download as GeoJSOn will be set programatically within component file -->
								</div>
							</div>

							<div ng-show="!showIsochrones && $ctrl.kommonitorDataExchangeServiceInstance.routingLegend">
								<br/>
								<br/>
								
								<div style="display: inline-block" align="center" id="reachabilityRouteButtonSection">
									<button ng-click="removeRoutingLayers()" type="button" class="btn btn-danger">Ergebnis verwerfen /
										Layer entfernen</button>
									<!-- another button to download as GeoJSOn will be set programatically within component file -->
								</div>
							</div>

						</div>						

			</div>
			<div ng-hide="showIsochrones" class="ng-hide" id="routing">
				
				<div class="just-padding">
	
					<label for="TODO">Startpunkt:</label>
	
					<div class="row vertical-align"
						style="margin-right:0px; border: 1px solid #ccc!important; border-radius: 6px; padding:4px;">
						<div class="col-md-6 col-sm-6 col-xs-6">
							<label for="TODO"><i class="fas fa-thumbtack"></i> Addresssuche:</label>
							<input id="startInput" type="text" ng-model="settings.routingStartPointInput"
								ng-change="onChangeRoutingStartPoint()" placeholder="Addresse eingeben ...">
	
							<div ng-show="geosearchResults_startingPoint.length > 0" class="leaflet-control-geosearch"
								style="overflow:auto; border: 1px solid #ccc!important; border-radius: 6px; padding:4px;">
								<div class="results active" style="overflow:auto;">
									<div class="" ng-repeat="geosearchResult in geosearchResults_startingPoint"
										ng-click="onClickGeosearchResult_startingPoint(geosearchResult)"
										style="overflow:unset;">
										{{geosearchResult.label}}
									</div>
								</div>
							</div>
	
						</div>
						<div class="col-md-6 col-sm-6 col-xs-6">
							<div ng-show="routingStartPoint.longitude && routingStartPoint.latitude">
								<label for="TODO"><i class="fas fa-map-marker-alt"></i> Longitude, Latitude:</label>
								<p>{{routingStartPoint.longitude}}, {{routingStartPoint.latitude}}</p>
							</div>
	
							<div ng-show="routingStartPoint.label">
								<label for="TODO">Bezeichner:</label>
								<p>{{routingStartPoint.label}}</p>
							</div>
						</div>
	
					</div>
	
					<br />
	
					<label for="TODO">Zielpunkt:</label>
	
					<div class="row vertical-align"
						style="margin-right:0px; border: 1px solid #ccc!important; border-radius: 6px; padding:4px;">
						<div class="col-md-6 col-sm-6 col-xs-6">
							<label for="TODO"><i class="fas fa-thumbtack"></i> Addresssuche:</label>
							<input id="endInput" type="text" ng-model="settings.routingEndPointInput"
								ng-change="onChangeRoutingEndPoint()" placeholder="Addresse eingeben ...">
	
							<div ng-show="geosearchResults_endPoint.length > 0" class="leaflet-control-geosearch"
								style="overflow:auto; border: 1px solid #ccc!important; border-radius: 6px; padding:4px;">
								<div class="results active" style="overflow:auto;">
									<div class="" ng-repeat="geosearchResult in geosearchResults_endPoint"
										ng-click="onClickGeosearchResult_endPoint(geosearchResult)" style="overflow:unset;">
										{{geosearchResult.label}}
									</div>
								</div>
							</div>
	
						</div>
						<div class="col-md-6 col-sm-6 col-xs-6">
							<div ng-show="routingEndPoint.longitude && routingEndPoint.latitude">
								<label for="TODO"><i class="fas fa-map-marker-alt"></i> Longitude, Latitude:</label>
								<p>{{routingEndPoint.longitude}}, {{routingEndPoint.latitude}}</p>
							</div>
	
							<div ng-show="routingEndPoint.label">
								<label for="TODO">Bezeichner:</label>
								<p>{{routingEndPoint.label}}</p>
							</div>
						</div>
	
					</div>
	
					<!-- </div> -->
					<br />
	
					<div align="center">
	
						<input type="button" class="btn btn-s btn-info" value="Analyse starten!"
							ng-disabled="!(routingStartPoint && routingEndPoint && !showIsochrones)"
							ng-click="startAnalysis()"></input>
						<input type="button" class="btn btn-s btn-danger" value="Zur&uuml;cksetzen"
							ng-click="resetForm()"></input>
					</div>
				</div>
				

			</div>

			<div ng-show="error">
				<br />
				<div class="alert alert-danger">
					<strong>Fehler</strong>
					Bei der Verarbeitung ist ein Fehler aufgetreten.
					<p></p>
					<strong>Fehlernachricht: </strong>
					<pre>{{error}}</pre>
				</div>
			</div>
		</div>
		<!-- /.box-body -->
	</div>
	<!-- /.box -->

	<div class="box box-primary collapsed-box">
		<div class="box-header with-border">
			<h3 class="box-title">Punktobjekte im Einzugsgebiet</h3>

			<div class="box-tools pull-right">
				<button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-plus"></i>
				</button>
			</div>
		</div>
		<!-- /.box-header -->

		<div class="box-body">

			<div align="center" ng-show="! currentIsochronesGeoJSON">
				<p>
					Bitte f&uuml;hren Sie zuerst eine Isochronenberechnung durch.
				</p>
			</div>

			<div align="center" ng-show="currentIsochronesGeoJSON">
				<div class="just-padding">
							
					<div class="" >

						<p>Bestimmen Sie ein Referenzdatum und selektieren relevante Punktlayer in der Tabelle. F&uuml;r jeden Punktlayer werden gem&auml;&szlig; des Referenzdatums 
							die g&uuml;ltigen Punktobjekte geladen und mit den zuvor berechneten Isochronen verschnitten.
						</p>

						<label>Art der Datumsdefinition zum Abruf eines Datensatzes</label>
						<div class="form-group">
							<label class="radio-inline"><input type="radio" name="settings.dateSelectionType"  ng-value="settings.dateSelectionType_valueIndicator" ng-model="settings.dateSelectionType.selectedDateType" ng-click="onClickUseIndicatorTimestamp()">Datum des aktuellen Indikators</label>
							<label class="radio-inline"><input type="radio" name="settings.dateSelectionType"  ng-value="settings.dateSelectionType_valueManual" ng-model="settings.dateSelectionType.selectedDateType">manuelles Datum
								<div ng-hide="!(settings.dateSelectionType.selectedDateType === settings.dateSelectionType_valueManual)" class="input-group date">
									<div class="input-group-addon">
										<i class="far fa-calendar-alt"></i>
									</div>
									<input type="text" ng-model="settings.selectedDate_manual" ng-change="onChangeManualDate()"
										class="form-control pull-right" placeholder="YYYY-MM-DD"
										id="manualDateDatepicker_reachabilityAnalysis" required>
								</div>
							</label>
							<label class="radio-inline"><input type="radio" name="settings.dateSelectionType"  ng-value="settings.dateSelectionType_valuePerDataset" ng-model="settings.dateSelectionType.selectedDateType">pro Datensatz</label>
						</div>

						<!-- <p>Selektieren eines Eintrags aus unten stehender Liste f&uuml;gt den entsprechenden Punkt-Layer der Kartendarstellung hinzu. Deselektion entfernt den entsprechenden Layer aus der Kartendarstellung.</p> -->
	
						<div class="input-group">
							<span class="input-group-addon"><i class="fas fa-filter"></i></span>
							<input type="text" class="form-control input-sm" placeholder="Stichwortfilter" ng-model="poiNameFilter_reachabilityAnalysis" ng-model-options="{debounce: 500, blur: 0}">
						</div>
	
						<br/>
	
						<div  id="poiInputForm_reachabilityAnalysis">
	
							<table class="table table-condensed" style="margin-bottom:0px;">
							<thead>
							  <tr>
								<th>Datensatz</th>
								<th>Beschreibung</th>
								<th>Legende</th>
								<th ng-if="settings.dateSelectionType.selectedDateType === settings.dateSelectionType_valuePerDataset">Zeitschnitt</th>
							  </tr>
							</thead>
	
								<tbody>
	
									<tr ng-repeat='poi in $ctrl.kommonitorDataExchangeServiceInstance.availableGeoresources | filter:$ctrl.kommonitorDataExchangeServiceInstance.filterGeoresourcesByPoi() | filter:$ctrl.kommonitorDataExchangeServiceInstance.filterPois() | filter:poiNameFilter_reachabilityAnalysis'>
										<!-- <span style="font-size:1.8em;" class="glyphicon glyphicon-th" aria-hidden="true"></span> -->
										<td>
											<label class='checkbox-inline' ><input type="checkbox" value="poi.datasetName" ng-model="poi.isSelected_reachabilityAnalysis" ng-change="handlePoiForAnalysis(poi)">											
	
												<b>&nbsp;&nbsp;{{poi.datasetName}}</b>
											</label>
										</td>
										<td>
											<p>{{poi.metadata.description}}</p>
										</td>
										<td class="text-center">
											<div align="center">
												<div class="awesome-marker-legend awesome-marker-legend-icon-{{poi.poiMarkerColor}}">
													<span style="margin-left:3px; margin-right:3px; margin-top: 2px;  font-size:1.2em; color:{{poi.poiSymbolColor}};" class="glyphicon glyphicon-{{poi.poiSymbolBootstrap3Name}}" aria-hidden="true"></span>
												</div>
											</div>	
										</td>
										<td ng-if="settings.dateSelectionType.selectedDateType === settings.dateSelectionType_valuePerDataset">
											<select style="font-size: 11px; width:135px; padding: 0px;"
													ng-model="poi.selectedDate" ng-change="onChangeSelectedDate(poi)" ng-options="date as date.startDate + ' - ' + date.endDate for date in poi.availablePeriodsOfValidity | orderBy: 'startDate'" ng-init="poi.selectedDate = poi.availablePeriodsOfValidity[poi.availablePeriodsOfValidity.length - 1]"
													class="form-control" required>
												</select>
										</td>
									</tr>
								</tbody>
							</table>

							<br/>

						</div>
	
							<br/>

							
							<div id="reachability_diagrams_section">

							</div>
							
	
					</div>

				</div>

			</div>

		</div>
		<!-- /.box-body -->

	</div>
	<!-- /.box -->

</div>